<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Share</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          crossorigin="anonymous">
</head>

<body class="p-4">

    <p class="mb-3">Hello world</p>

    <div class="d-flex gap-2">

        <!-- SHARE BUTTON -->
        <button class="btn btn-outline-dark fw-semibold"
                type="button"
                onclick="shareImage()">
            Share QR Code
        </button>

        <!-- COPY IMAGE + OPEN WHATSAPP WEB CHAT -->
        <button class="btn btn-outline-primary fw-semibold"
                type="button"
                onclick="copyImageAndOpenChat()">
            Copy Image
        </button>

    </div>

    <script>
        /* -----------------------------
           SHARE IMAGE (OS SHARE UI)
        ------------------------------ */
        async function shareImage() {
            const response = await fetch("./images/qrcode.png");
            const blob = await response.blob();
            const file = new File([blob], "qrcode.png", { type: "image/png" });

            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                    files: [file],
                    title: "QR Code",
                    text: "Here's the QR code image"
                });
            } else {
                alert("Sharing not supported.");
            }
        }

        /* ---------------------------------------------
           COPY IMAGE + OPEN WHATSAPP WEB (BROWSER ONLY)
        ---------------------------------------------- */
        async function copyImageAndOpenChat() {
            try {
                const response = await fetch("./images/qrcode.png");
                const blob = await response.blob();

                // Copy REAL image to clipboard
                await navigator.clipboard.write([
                    new ClipboardItem({
                        "image/png": blob
                    })
                ]);

                // FORCE WhatsApp WEB (not app)
                const phoneNumber = "919100728556";
                const whatsappWebUrl =
                    `https://web.whatsapp.com/send?phone=${phoneNumber}`;

                window.open(whatsappWebUrl, "_blank");

            } catch (err) {
                console.error(err);
                alert("Copy failed. HTTPS & permissions required.");
            }
        }
    </script>

</body>
</html>
